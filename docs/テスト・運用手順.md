# テスト・運用手順

## テスト環境の準備

1. テスト用の Google スプレッドシートを準備

   - 作業記録テスト用スプレッドシート
   - 請求書テンプレートのコピー
   - テスト出力用フォルダの作成

2. テスト用の環境変数を設定

   ```javascript
   // テスト用の設定
   var TEST_CONFIG = {
     WORK_LOG: {
       FILE_ID: 'テスト用作業記録SpreadsheetID',
       SHEET_NAME: '作業記録',
       COLUMNS: {
         /* 本番環境と同じ */
       },
     },
     INVOICE: {
       TEMPLATE_ID: 'テスト用請求書テンプレートID',
       OUTPUT_FOLDER_ID: 'テスト出力フォルダID',
       CELLS: {
         /* 本番環境と同じ */
       },
       OUTPUT_SHEET_NAME: 'ダウンロード用',
     },
     PAYEE: { NAME: '東顕正' },
   };
   ```

## テスト項目

### 1. 基本機能テスト

- [ ] 作業時間の集計

  - 当月の作業時間が正しく集計されるか
  - 他の月のデータが含まれていないか

- [ ] 請求書生成

  - 請求日が正しく設定されるか（月末日）
  - 請求書番号が正しく設定されるか（yyyymmdd 形式）
  - 作業時間が正しく入力されるか
  - 金額が正しく計算されるか

- [ ] PDF 出力
  - 「ダウンロード用」シートが正しく出力されるか
  - ファイル名が正しく設定されるか（yyyymmdd*金額*東顕正.pdf）
  - 出力先フォルダに保存されるか
  - 元のコピーファイルが削除されるか

### 2. エラー処理テスト

- [ ] シートが存在しない場合

  - 適切なエラーメッセージが表示されるか

- [ ] 当月のデータがない場合

  - 作業時間が 0 になるか
  - エラーなく処理が完了するか

- [ ] 権限がない場合
  - 適切なエラーメッセージが表示されるか

### 3. 運用リハーサルテスト

1. 実環境のコピーを使ったテスト

   - 本番環境と同じ構成でテストを実施
   - エラーなく一連の処理が完了するか

2. 月末日の処理確認
   - 月末日に実行した場合の動作確認
   - 翌月 1 日に前月分のデータで実行した場合の動作確認

## 本番環境切り替え手順

1. テスト環境での動作確認後、本番用設定に切り替え

   ```javascript
   var CONFIG = {
     WORK_LOG: {
       FILE_ID: '1vCw-kt1eGBlRmLqAu8urEoX-oNYJbbbgqGDfLW7h9JI',
       // 他の設定...
     },
     // 他の設定...
   };
   ```

2. 本番環境での権限確認

   - 全ての対象スプレッドシートにアクセスできるか
   - 出力先フォルダに書き込み権限があるか

3. 本番実行
   - 手動で１回実行し、結果を確認
   - 問題なければ、必要に応じてトリガーを設定

## トリガー設定（オプション）

月末に自動実行する場合のトリガー設定：

1. GAS エディタで「トリガー」タブを開く
2. 「トリガーを追加」をクリック
3. 以下の設定で作成：
   - 実行する関数: `createInvoice`
   - イベントのソースを選択: 「日付ベースのタイマー」
   - 時間の種類を選択: 「月ベース」
   - 日付を選択: 「月末」
   - 時刻を選択: 「23-24 時」
4. 「保存」をクリック

## 更新履歴

| 日付       | バージョン | 更新内容       |
| ---------- | ---------- | -------------- |
| 2025/05/31 | v1.0.0     | 初期バージョン |
