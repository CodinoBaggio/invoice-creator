# 請求書自動作成システム 利用マニュアル

## 概要

このシステムは、Google Apps Script（GAS）を利用して、作業記録スプレッドシートから当月の作業時間を自動集計し、請求書テンプレートに値を差し込んで PDF 出力・保存する自動化スクリプトです。

## 前提条件

1. Google アカウントにログインしていること
2. 対象のスプレッドシートへのアクセス権限があること
   - 作業記録スプレッドシート: `1vCw-kt1eGBlRmLqAu8urEoX-oNYJbbbgqGDfLW7h9JI`
   - 請求書テンプレート: `1gv2H0YM5qxhWm_bJTPjmFBK3YHXfFZrdRHXrG6bmSgg`
3. 出力用フォルダへの書き込み権限があること
   - 出力フォルダ: `1FKxvmPu4icl4XOWZC9JM1Xc1mpMXnn5A`

## ファイル構成

### 作業記録スプレッドシート

作業記録スプレッドシートには、以下のカラム構成でデータを記録してください：

| 列  | 項目名   | データ型 | 内容                   |
| --- | -------- | -------- | ---------------------- |
| A   | 作業 ID  | 文字列   | 任意の識別子           |
| B   | 作業日   | 日付     | 実作業日。月次抽出対象 |
| C   | 作業時間 | 数値     | 単位：時間（小数あり） |
| D   | 作業内容 | 文字列   | 任意入力の説明欄       |
| E   | 作成日   | 日時     | レコード作成時の時刻   |
| F   | 更新日   | 日時     | レコード更新時の時刻   |

### 請求書テンプレート

請求書テンプレートには、以下の構成で値が入力されます：

| セル | 項目名         | 内容                                               |
| ---- | -------------- | -------------------------------------------------- |
| E4   | 請求日         | 月末日（例：2025/05/31）                           |
| E5   | 請求書番号     | 月末日を `yyyymmdd` 形式に変換した値               |
| C33  | 作業時間入力欄 | GAS から合計作業時間を反映（テンプレ内で金額算出） |
| F30  | 請求金額       | テンプレ内の関数により計算される税込金額           |

## 利用手順

### 1. スクリプトのデプロイ

既に clasp を使ってデプロイされている場合は、この手順をスキップしてください。

```bash
cd invoice-creator
npm run deploy
```

### 2. スクリプトの実行

1. Google Apps Script エディタを開く
   - URL: https://script.google.com
2. デプロイしたプロジェクトを選択
3. 関数`createInvoice`を選択して実行
4. 初回実行時は必要な認証を行ってください

### 3. 結果の確認

実行が完了すると、指定された Google Drive フォルダに以下の命名規則で PDF が保存されます：
`yyyymmdd_金額_東顕正.pdf`

例: `20250531_49895_東顕正.pdf`

## トラブルシューティング

エラーが発生した場合は、以下を確認してください：

1. 適切な権限があるか
2. スプレッドシートの ID、シート名、セル位置が正しいか
3. スプレッドシートに当月のデータが存在するか
4. 「ダウンロード用」シートが存在するか

## 将来的な拡張案

- クライアントごとの金額・テンプレート切替対応
- Gmail API を利用した PDF の自動送信機能
- Firestore や別シートへの請求履歴蓄積
- UI メニュー化による手動操作補助（カスタムメニュー）
